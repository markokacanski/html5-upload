<html>
	<head>
		<title>HTML5UPLOAD</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/jquery.fileupload.css">
	</head>
	<body>
		<h1>Large file upload</h1>
		<div class="upload_area">
			<input type="file" id="fileupload" name="files[]" multiple>
		</div>

		<div id="progress" class="progress">
			<div class="progress-bar progress-bar-success">
			</div>
		</div>

		<%# javascripts %>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/vendor/jquery.ui.widget.js"></script>
		<script src="js/jquery.iframe-transport.js"></script>
		<script src="js/jquery.fileupload.js"></script>

		<script>
			$(function () {
				'use strict';
				var url = "/upload";
				$('#fileupload').fileupload({
					url: url,
					dataType: 'json',
					maxChunkSize: 1024 * 1024, //1 megabyte
					

					add: function (e, data) {
		        var that = this;
		        $.getJSON('/upload', {file: data.files[0].name}, function (result) {
		            var file = result.file;
		            data.uploadedBytes = file && file.size;
		            $.blueimp.fileupload.prototype
		                .options.add.call(that, e, data);
		        });
					 },


					done: function (e, data){
						$.each(data.result.files, function  (index, file) {
								$('<p/>').text(file.name).appendTo('#files');
						})
					},

					progressall: function  (e, data) {
						var progress = parseInt(data.loaded / data.total * 100, 10);
						$('#progress .progress-bar').css(
							'width',
							progress + '%'
							);
					},


				}).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled')
			});
		</script>
	</body>
</html>